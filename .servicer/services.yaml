ci:
  providers:
    - circleci
  image: circleci/python:3.6.4

git:
  enabled: true
  default-branch: origin/master
  ignore_paths:
    - '*README.md'

providers:
  pypi:
    libraries:
      - twine==1.11.0

services:
  pypi:
    provider: pypi
    service_type: pypi

    git:
      watch_paths:
        - servicer/*

    config:
      steps:
        - type: setup_py
          args:
            command: sdist
        - type: generate_pypi_config
        - type: upload

    steps:
      test:
        commands:
          - python -m unittest discover -b

environment:
  mappings:
    - branch: master
      environment: production
    - branch: develop
    - branch: env-*
